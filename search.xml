<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>redis</title>
      <link href="/2022/03/06/redis/"/>
      <url>/2022/03/06/redis/</url>
      
        <content type="html"><![CDATA[<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p><strong>Redis 是典型的 NoSQL 数据库。</strong><br>redis官网：<a href="https://redis.io/download">https://redis.io/download</a><br>Redis 是一个开源的 key-value 存储系统。</p><p>和 Memcached 类似，它支持存储的 value 类型相对更多，包括 string、list、set、zset、sorted set、hash。</p><p>这些数据类型都支持 push/pop、add/remove 及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。</p><p>在此基础上，Redis 支持各种不同方式的排序。</p><p>与 memcached一样，为了保证效率，数据都是缓存在内存中。</p><p>区别的是 Redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件。</p><p>并且在此基础上实现了master-slave （主从）同步。</p><p>单线程 + IO 多路复用。</p><h2 id="安装和启动"><a href="#安装和启动" class="headerlink" title="安装和启动"></a>安装和启动</h2><p>安装 C 语言的编译环境</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install centos-release-scl scl-utils-build</span><br><span class="line">yum install -y devtoolset-8-toolchain</span><br><span class="line">scl enable devtoolset-8 bash</span><br></pre></td></tr></tbody></table></figure><p>通过 wget 下载</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.redis.io/releases/redis-6.2.6.tar.gz</span><br><span class="line">// 下载路径：/opt</span><br></pre></td></tr></tbody></table></figure><p>解压至当前目录</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-6.2.6.tar.gz </span><br></pre></td></tr></tbody></table></figure><p>解压完成后进入目录</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd redis-6.2.6</span><br></pre></td></tr></tbody></table></figure><p>在当前目录下执行 make</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure><p>默认安装在 /usr/local/bin<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306123259.png"></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark：性能测试工具，可以在自己本子运行，看看自己本子性能如何</span><br><span class="line">redis-check-aof：修复有问题的AOF文件，rdb和aof后面讲</span><br><span class="line">redis-check-dump：修复有问题的dump.rdb文件</span><br><span class="line">redis-sentinel：Redis集群使用</span><br><span class="line">redis-server：Redis服务器启动命令</span><br><span class="line">redis-cli：客户端，操作入口</span><br></pre></td></tr></tbody></table></figure><p>前台启动：***/usr/local/bin*** 目录下启动 redis</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server(前台启动)</span><br></pre></td></tr></tbody></table></figure><p>后台启动：</p><ul><li>安装 redis 的目录 /opt/redis-6.2.6 中将 redis.conf 复制到任意一个文件夹下<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf /etc/redis.conf</span><br><span class="line">// 将redis.conf复制到/etc/下</span><br></pre></td></tr></tbody></table></figure></li><li>修改 /etc/redis.conf 配置文件<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf# daemonize no 修改为 daemonize yes</span><br></pre></td></tr></tbody></table></figure></li><li>/usr/local/bin 目录下启动 redis<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /etc/redis.conf</span><br></pre></td></tr></tbody></table></figure>关闭 redis<br>kill 进程<br>命令 shutdown</li><li><em>默认端口号:6379</em>*</li></ul><h2 id="NoSQL数据库"><a href="#NoSQL数据库" class="headerlink" title="NoSQL数据库"></a>NoSQL数据库</h2><ul><li>解决 CPU 及内存压力</li><li>解决 IO 压力</li></ul><p>NoSQL（ NoSQL = Not Only SQL ），意即不仅仅是 SQL，泛指非关系型的数据库；<br>NoSQL 不依赖业务逻辑方式存储，而以简单的 key-value 模式存储。因此大大的增加了数据库的扩展能力。</p><ul><li>不遵循 SQL 标准。</li><li>不支持 ACID。</li><li>远超于 SQL 的性能。<br>适用于的场景</li><li>对数据高并发的读写；</li><li>海量数据的读写；</li><li>对数据高可扩展性的。<br>不适用的场景</li><li>需要事务支持；</li><li>基于 sql 的结构化查询存储，处理复杂的关系，需要即席查询；<br>常见的 NoSQL 数据库</li><li>redis</li><li>MongoDB</li></ul><p>大数据时代常用的数据库类型<br>行式数据库<br>列式数据库</p><h2 id="常用五大数据类型"><a href="#常用五大数据类型" class="headerlink" title="常用五大数据类型"></a>常用五大数据类型</h2><p>哪里去获得redis常见数据类型操作命令<a href="http://www.redis.cn/commands.html">http://www.redis.cn/commands.html</a><br><strong>Redis键(key)</strong><br>keys *查看当前库所有key    (匹配：keys *1)<br>exists key判断某个key是否存在<br>type key 查看你的key是什么类型<br>del key   删除指定的key数据<br>unlink key   根据value选择非阻塞删除<br>仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。<br>expire key 10   10秒钟：为给定的key设置过期时间<br>ttl key 查看还有多少秒过期，-1表示永不过期，-2表示已过期<br>select命令切换数据库<br>dbsize查看当前数据库的key的数量<br>flushdb清空当前库<br>flushall通杀全部库<br><strong>Redis字符串(String)</strong><br>String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。<br>String类型是二进制安全的。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。<br>String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M<br>常用命令<br>set   <key><value>添加键值对<br>*NX：当数据库中key不存在时，可以将key-value添加数据库<br>*XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥<br>*EX：key的超时秒数<br>*PX：key的超时毫秒数，与EX互斥<br>get   <key>查询对应键值<br>append  <key><value>将给定的<value> 追加到原值的末尾<br>strlen  <key>获得值的长度<br>setnx  <key><value>只有在 key 不存在时    设置 key 的值<br>incr  <key><br>将 key 中储存的数字值增1<br>只能对数字值操作，如果为空，新增值为1<br>decr  <key><br>将 key 中储存的数字值减1<br>只能对数字值操作，如果为空，新增值为-1<br>incrby / decrby  <key>&lt;步长&gt;将 key 中储存的数字值增减。自定义步长。</key></key></key></value></key></key></value></value></key></key></value></key></p><h2 id="原子性"><a href="#原子性" class="headerlink" title="原子性"></a>原子性</h2><p>所谓原子操作是指不会被线程调度机制打断的操作；<br>这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。<br>（1）在单线程中， 能够在单条指令中完成的操作都可以认为是”原子操作”，因为中断只能发生于指令之间。<br>（2）在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。<br>Redis单命令的原子性主要得益于Redis的单线程<br>getrange  <key>&lt;起始位置&gt;&lt;结束位置&gt;<br>获得值的范围，类似java中的substring，前包，后包<br>setrange  <key>&lt;起始位置&gt;<value><br>用 <value>  覆写<key>所储存的字符串值，从&lt;起始位置&gt;开始(索引从0开始)。<br>setex  <key>&lt;过期时间&gt;<value><br>设置键值的同时，设置过期时间，单位秒。<br>getset <key><value><br>以新换旧，设置了新值同时获得旧值。</value></key></value></key></key></value></value></key></key></p><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307004616.png"><br>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。<br><strong>Redis列表(List)</strong><br>单键多值<br>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）<br>它的底层实际是个双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。<br><strong>常用命令</strong><br>lpush/rpush  <key><value1><value2><value3> …. 从左边/右边插入一个或多个值。<br>lpop/rpop  <key>从左边/右边吐出一个值。值在键在，值光键亡。</key></value3></value2></value1></key></p><p>rpoplpush  <key1><key2>从<key1>列表右边吐出一个值，插到<key2>列表左边。</key2></key1></key2></key1></p><p>lrange <key><start><stop><br>按照索引下标获得元素(从左到右)<br>lrange mylist 0 -1   0左边第一个，-1右边第一个，（0-1表示获取所有）<br>lindex <key><index>按照索引下标获得元素(从左到右)<br>llen <key>获得列表长度 </key></index></key></stop></start></key></p><p>linsert <key>  before <value><newvalue>在<value>的后面插入<newvalue>插入值<br>lrem <key><n><value>从左边删除n个value(从左到右)<br>lset<key><index><value>将列表key下标为index的值替换成value<br><strong>数据结构</strong><br>List的数据结构为快速链表quickList。<br>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。<br>它将所有的元素紧挨着一起存储，分配的是一块连续的内存。<br>当数据量比较多的时候才会改成quicklist。<br>因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307005248.png"><br>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。<br><strong>Redis集合(Set)</strong><br>Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。<br>Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的复杂度都是O(1)。<br>一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变<br><strong>常用命令</strong><br>sadd <key><value1><value2> …..<br>将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略<br>smembers <key>取出该集合的所有值。<br>sismember <key><value>判断集合<key>是否为含有该<value>值，有1，没有0<br>scard<key>返回该集合的元素个数。<br>srem <key><value1><value2> …. 删除集合中的某个元素。<br>spop <key>随机从该集合中吐出一个值。<br>srandmember <key><n>随机从该集合中取出n个值。不会从集合中删除 。<br>smove <source><destination>value把集合中一个值从一个集合移动到另一个集合<br>sinter <key1><key2>返回两个集合的交集元素。<br>sunion <key1><key2>返回两个集合的并集元素。<br>sdiff <key1><key2>返回两个集合的差集元素(key1中的，不包含key2中的)<br><strong>数据结构</strong><br>Set数据结构是dict字典，字典是用哈希表实现的。<br>Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。<br><strong>Redis哈希(Hash)</strong><br>Redis hash 是一个键值对集合。<br>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。<br>类似Java里面的Map&lt;String,Object&gt;<br>用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储<br>主要有以下2种存储方式：<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307010949.png"><br><strong>常用命令</strong><br>hset <key><field><value>给<key>集合中的  <field>键赋值<value><br>hget <key1><field>从<key1>集合<field>取出 value<br>hmset <key1><field1><value1><field2><value2>… 批量设置hash的值<br>hexists<key1><field>查看哈希表 key 中，给定域 field 是否存在。<br>hkeys <key>列出该hash集合的所有field<br>hvals <key>列出该hash集合的所有value<br>hincrby <key><field><increment>为哈希表 key 中的域 field 的值加上增量 1   -1<br>hsetnx <key><field><value>将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 .<br><strong>数据结构</strong><br>Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）。当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable。<br><strong>Redis有序集合Zset(sorted set)</strong><br>Redis有序集合zset与普通集合set非常相似，是一个没有重复元素的字符串集合。<br>不同之处是有序集合的每个成员都关联了一个评分（score）,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了 。<br>因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。<br>访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。<br><strong>常用命令</strong><br>zadd  <key><score1><value1><score2><value2>…<br>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。<br>zrange <key><start><stop>  [WITHSCORES]<br>返回有序集 key 中，下标在<start><stop>之间的元素<br>带WITHSCORES，可以让分数一起和值返回到结果集。<br>zrangebyscore key minmax [withscores] [limit offset count]<br>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。<br>zrevrangebyscore key maxmin [withscores] [limit offset count]<br>同上，改为从大到小排列。<br>zincrby <key><increment><value>      为元素的score加上增量<br>zrem  <key><value>删除该集合下，指定值的元素<br>zcount <key><min><max>统计该集合，分数区间内的元素个数<br>zrank <key><value>返回该值在集合中的排名，从0开始。<br>案例：如何利用zset实现一个文章访问量的排行榜？<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307010956.png"><br><strong>数据结构</strong><br>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。<br>zset底层使用了两个数据结构<br>（1）hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。<br>（2）跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。<br><strong>跳跃表</strong><br>有序集合在生活中比较常见，例如根据成绩对学生排名，根据得分对玩家排名等。对于有序集合的底层实现，可以用数组、平衡树、链表等。数组不便元素的插入、<br>删除；平衡树或红黑树虽然效率高但结构复杂；链表查询需要遍历所有效率低。Redis采用的是跳跃表。跳跃表效率堪比红黑树，实现远比红黑树简单。<br>实例<br>对比有序链表和跳跃表，从链表中查询出51<br>（1）    有序链表<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011710.png"><br>要查找值为51的元素，需要从第一个元素开始依次查找、比较才能找到。共需要6次比较。<br>（2）    跳跃表<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011718.png"><br>从第2层开始，1节点比51节点小，向后比较。<br>21节点比51节点小，继续向后比较，后面就是NULL了，所以从21节点向下到第1层<br>在第1层，41节点比51节点小，继续向后，61节点比51节点大，所以从41向下<br>在第0层，51节点为要查找的节点，节点被找到，共查找4次。<br>从此可以看出跳跃表比有序链表效率要高</value></key></max></min></key></value></key></value></increment></key></stop></start></stop></start></key></value2></score2></value1></score1></key></value></field></key></increment></field></key></key></key></field></key1></value2></field2></value1></field1></key1></field></key1></field></key1></value></field></key></value></field></key></key2></key1></key2></key1></key2></key1></destination></n></key></key></value2></value1></key></key></value></key></value></key></key></value2></value1></key></value></index></key></value></n></key></newvalue></value></newvalue></value></key></p><h2 id="Redis配置文件介绍"><a href="#Redis配置文件介绍" class="headerlink" title="Redis配置文件介绍"></a>Redis配置文件介绍</h2><p>Units单位<br>配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit<br>大小写不敏感<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011859.png"><br>INCLUDES包含<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011906.png"><br>类似jsp中的include，多实例的情况可以把公用的配置文件提取出来<br>网络相关配置<br>默认情况bind=127.0.0.1只能接受本机的访问请求<br>不写的情况下，无限制接受任何ip地址的访问<br>生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉<br>如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011914.png"><br>保存配置，停止服务，重启启动查看进程，不再是本机访问了.<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307011922.png"><br>protected-mode<br>将本机访问保护模式设置no<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012024.png"><br>端口号，默认 6379<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012031.png"><br>tcp-backlog<br>设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。<br>在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。<br>注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值（128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值来达到想要的效果<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012037.png"><br>timeout<br>一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即永不关闭。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012042.png"><br>tcp-keepalive<br>对访问客户端的一种心跳检测，每个n秒检测一次。<br>单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012047.png"><br>GENERAL通用<br>daemonize<br>是否为后台进程，设置为yes<br>守护进程，后台启动<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012051.png"><br>pidfile<br>存放pid文件的位置，每个实例会产生一个不同的pid文件<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012058.png"><br>loglevel<br>指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为notice<br>四个级别根据使用阶段来选择，生产环境选择notice 或者warning<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012105.png"><br>logfile<br>日志文件名称<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012109.png"><br>database 16<br>设定库的数量 默认16，默认数据库为0，可以使用SELECT <dbid>命令在连接上指定数据库id<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012113.png"><br>SECURITY安全<br>设置密码<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012120.png"><br>访问密码的查看、设置和取消<br>在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。<br>永久设置，需要再配置文件中进行设置。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012132.png"><br>LIMITS限制<br>maxclients<br>设置redis同时可以与多少个客户端进行连接。<br>默认情况下为10000个客户端。<br>如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012137.png"><br>maxmemory<br>建议必须设置，否则，将内存占满，造成服务器宕机<br>设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过maxmemory-policy来指定。<br>如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。<br>但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012145.png"><br>maxmemory-policy<br>volatile-lru：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）<br>allkeys-lru：在所有集合key中，使用LRU算法移除key<br>volatile-random：在过期集合中移除随机的key，只对设置了过期时间的键<br>allkeys-random：在所有集合key中，移除随机的key<br>volatile-ttl：移除那些TTL值最小的key，即那些最近要过期的key<br>noeviction：不进行移除。针对写操作，只是返回错误信息<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012153.png"><br>maxmemory-samples<br>设置样本数量，LRU算法和最小TTL算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis默认会检查这么多个key并选择其中LRU的那个。<br>一般设置3到7的数字，数值越小样本越不准确，但性能消耗越小<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/07/QQ%E6%88%AA%E5%9B%BE20220307012158.png"></dbid></p><h2 id="Redis的发布和订阅"><a href="#Redis的发布和订阅" class="headerlink" title="Redis的发布和订阅"></a>Redis的发布和订阅</h2><p>什么是发布和订阅<br>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。<br>Redis 客户端可以订阅任意数量的频道。<br>Redis的发布和订阅<br>1 客户端可以订阅频道如下图<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307013924.png"><br>2 当给这个频道发布消息后，消息就会发送给订阅的客户端<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307013929.png"><br>3 发布订阅命令行实现<br>打开一个客户端订阅channel1<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307013934.png"><br>SUBSCRIBE channel1<br>打开另一个客户端，给channel1发布消息hello<br>publish channel1 hello<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307013938.png"><br>返回的1是订阅者数量<br>打开第一个客户端可以看到发送的消息<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307013942.png"><br>注：发布的消息没有持久化，如果在订阅的客户端收不到hello，只能收到订阅后发布的消息</p><h2 id="Jedis测试"><a href="#Jedis测试" class="headerlink" title="Jedis测试"></a>Jedis测试</h2><p>Jedis所需要的jar包</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;3.2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="连接Redis注意事项"><a href="#连接Redis注意事项" class="headerlink" title="连接Redis注意事项"></a>连接Redis注意事项</h2><p>禁用Linux的防火墙：Linux(CentOS7)里执行命令<br>systemctl stop/disable firewalld.service<br>redis.conf中注释掉bind 127.0.0.1 ,然后 protected-mode no<br>Jedis常用操作<br>创建动态的工程<br>创建测试程序</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Demo01 {</span><br><span class="line">public static void main(String[] args) {</span><br><span class="line">Jedis jedis = new Jedis("192.168.137.3",6379);</span><br><span class="line">String pong = jedis.ping();</span><br><span class="line">System.out.println("连接成功："+pong);</span><br><span class="line">jedis.close();</span><br></pre></td></tr></tbody></table></figure><p>测试相关数据类型</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jedis.set("k1", "v1");</span><br><span class="line">jedis.set("k2", "v2");</span><br><span class="line">jedis.set("k3", "v3");</span><br><span class="line">Set&lt;String&gt; keys = jedis.keys("*");</span><br><span class="line">System.out.println(keys.size());</span><br><span class="line">for (String key : keys) {</span><br><span class="line">System.out.println(key);</span><br><span class="line">}</span><br><span class="line">System.out.println(jedis.exists("k1"));</span><br><span class="line">System.out.println(jedis.ttl("k1"));                </span><br><span class="line">System.out.println(jedis.get("k1"));</span><br></pre></td></tr></tbody></table></figure><p>Jedis-API:    String</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jedis.mset("str1","v1","str2","v2","str3","v3");</span><br><span class="line">System.out.println(jedis.mget("str1","str2","str3"));</span><br></pre></td></tr></tbody></table></figure><p>Jedis-API:    List</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = jedis.lrange("mylist",0,-1);</span><br><span class="line">for (String element : list) {</span><br><span class="line">System.out.println(element);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Jedis-API:    set</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jedis.sadd("orders", "order01");</span><br><span class="line">jedis.sadd("orders", "order02");</span><br><span class="line">jedis.sadd("orders", "order03");</span><br><span class="line">jedis.sadd("orders", "order04");</span><br><span class="line">Set&lt;String&gt; smembers = jedis.smembers("orders");</span><br><span class="line">for (String order : smembers) {</span><br><span class="line">System.out.println(order);</span><br><span class="line">}</span><br><span class="line">jedis.srem("orders", "order02");</span><br></pre></td></tr></tbody></table></figure><p>Jedis-API:    hash</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jedis.hset("hash1","userName","lisi");</span><br><span class="line">System.out.println(jedis.hget("hash1","userName"));</span><br><span class="line">Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();</span><br><span class="line">map.put("telphone","13810169999");</span><br><span class="line">map.put("address","atguigu");</span><br><span class="line">map.put("email","abc@163.com");</span><br><span class="line">jedis.hmset("hash2",map);</span><br><span class="line">List&lt;String&gt; result = jedis.hmget("hash2", "telphone","email");</span><br><span class="line">for (String element : result) {</span><br><span class="line">System.out.println(element);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Jedis-API:    zset</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jedis.zadd("zset01", 100d, "z3");</span><br><span class="line">jedis.zadd("zset01", 90d, "l4");</span><br><span class="line">jedis.zadd("zset01", 80d, "w5");</span><br><span class="line">jedis.zadd("zset01", 70d, "z6");</span><br><span class="line">Set&lt;String&gt; zrange = jedis.zrange("zset01", 0, -1);</span><br><span class="line">for (String e : zrange) {</span><br><span class="line">System.out.println(e);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="Redis-Jedis-实例"><a href="#Redis-Jedis-实例" class="headerlink" title="Redis_Jedis_实例"></a>Redis_Jedis_实例</h2><p><strong>手机验证码功能</strong><br>1、输入手机号，点击发送后随机生成6位数字码，2分钟有效<br>2、输入验证码，点击验证，返回成功或失败<br>3、每个手机号每天只能输入3次</p><h2 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h2><p>1、    在pom.xml文件中引入redis相关依赖</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.6.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure><p>2、    application.properties配置redis配置<br>#Redis服务器地址<br>spring.redis.host=192.168.140.136<br>#Redis服务器连接端口<br>spring.redis.port=6379<br>#Redis数据库索引（默认为0）<br>spring.redis.database= 0<br>#连接超时时间（毫秒）<br>spring.redis.timeout=1800000<br>#连接池最大连接数（使用负值表示没有限制）<br>spring.redis.lettuce.pool.max-active=20<br>#最大阻塞等待时间(负数表示没限制)<br>spring.redis.lettuce.pool.max-wait=-1<br>#连接池中的最大空闲连接<br>spring.redis.lettuce.pool.max-idle=5<br>#连接池中的最小空闲连接<br>spring.redis.lettuce.pool.min-idle=0</p><p>3、    添加redis配置类</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@EnableCaching</span><br><span class="line">@Configuration</span><br><span class="line">public class RedisConfig extends CachingConfigurerSupport {</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = new ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">//key序列化方式</span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">//value序列化</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">//value hashmap序列化</span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        return template;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public CacheManager cacheManager(RedisConnectionFactory factory) {</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">//解决查询缓存转换异常的问题</span><br><span class="line">        ObjectMapper om = new ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">// 配置序列化（解决乱码的问题）,过期时间600秒</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(600))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        return cacheManager;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4、测试一下<br>RedisTestController中添加测试方法</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping("/redisTest")</span><br><span class="line">public class RedisTestController {</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    public String testRedis() {</span><br><span class="line">        //设置值到redis</span><br><span class="line">        redisTemplate.opsForValue().set("name","lucy");</span><br><span class="line">        //从redis获取值</span><br><span class="line">        String name = (String)redisTemplate.opsForValue().get("name");</span><br><span class="line">        return name;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="Redis-事务-锁机制-秒杀"><a href="#Redis-事务-锁机制-秒杀" class="headerlink" title="Redis_事务_锁机制_秒杀"></a>Redis_事务_锁机制_秒杀</h2><p>Redis的事务定义<br>Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。<br>Redis事务的主要作用就是串联多个命令防止别的命令插队。<br><strong>Multi、Exec、discard</strong><br>从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。<br>组队的过程中可以通过discard来放弃组队<br>事务的错误处理<br>组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消<br>如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。<br><strong>悲观锁</strong><br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307031215.png"><br>悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁<br><strong>乐观锁</strong><br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/072/QQ%E6%88%AA%E5%9B%BE20220307031220.png"><br>乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis就是利用这种check-and-set机制实现事务的。<br>WATCH key [key …]<br>在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。<br>unwatch<br>取消 WATCH 命令对所有 key 的监视。<br>如果在执行 WATCH 命令之后，EXEC 命令或DISCARD 命令先被执行了的话，那么就不需要再执行UNWATCH 了。<br><a href="http://doc.redisfans.com/transaction/exec.html">http://doc.redisfans.com/transaction/exec.html</a></p><h2 id="Redis事务三特性"><a href="#Redis事务三特性" class="headerlink" title="Redis事务三特性"></a>Redis事务三特性</h2><ul><li>单独的隔离操作 <ul><li> 事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li></ul></li><li>没有隔离级别的概念 <ul><li>队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</li></ul></li><li>不保证原子性 <ul><li>事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚 </li></ul></li></ul><h2 id="Redis-事务-秒杀案例"><a href="#Redis-事务-秒杀案例" class="headerlink" title="Redis_事务_秒杀案例"></a>Redis_事务_秒杀案例</h2><p>解决计数器和人员记录的事务操作<br>Redis事务–秒杀并发模拟<br>使用工具ab模拟测试<br>CentOS6 默认安装<br>CentOS7需要手动安装<br>yum install httpd-tools<br>进入cd  /run/media/root/CentOS 7 x86_64/Packages（路径跟centos6不同）<br>（2） 顺序安装<br>apr-1.4.8-3.el7.x86_64.rpm<br>apr-util-1.5.2-6.el7.x86_64.rpm<br>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm<br>测试及结果<br>通过ab测试<br>vim postfile 模拟表单提交参数,以&amp;符号结尾;存放当前目录<br>内容:prodid=0101&amp;<br>ab -n 2000 -c 200 -k -p ~/postfile -T application/x-www-form-urlencoded <a href="http://192.168.2.115:8081/Seckill/doseckill">http://192.168.2.115:8081/Seckill/doseckill</a></p>]]></content>
      
      
      <categories>
          
          <category> NoSql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurity</title>
      <link href="/2022/03/06/springsecurity/"/>
      <url>/2022/03/06/springsecurity/</url>
      
        <content type="html"><![CDATA[<h2 id="SpringSecurity实战"><a href="#SpringSecurity实战" class="headerlink" title="SpringSecurity实战"></a>SpringSecurity实战</h2><h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>基本上涉及到用户参与的系统都要进行权限管理，权限管理属于系统安全的范畴,权限管理实现<strong>对用户访问系统的控制</strong>按照<strong>安全规则</strong>或者<strong>安全策略</strong>控制用户<strong>可以访问而且只能访问自己</strong><br>权限管理包括身份认证和授权两部分，简称认证授权。对于需要访问控制的资源用户 首先经过身份认证，认证通过后用户具有该资源的权限方可访问</p><h3 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h3><p><strong>身份认证，</strong>就是判断一个用户是否为合法用户的处理过程，最常用的简单身份认证是系统通过核对用户输入的用户名和口令，看其是否与系统中存储的该用户的用户名和口令一致，来判断用户身份是否正确，对于采用<strong>指纹</strong>等系统，则出示指纹；对于硬件Key等刷卡系统，则需要刷卡</p><h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><p><strong>授权，</strong> 既访问控制，控制谁能访问哪些资源。主体进行身份认证后需要分配权限方可访问系统的资源，对于某些资源没有权限是无法访问的</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>和其他领域不同，在JAVA企业级开发中，安全管理框架非常少，目前比较常见的就是：</p><ul><li>Shrio<ul><li>Shiro本身是一个老牌的安全管理框架，有着众多的有点，例如轻量、简单、易于集成、可以在JavaSE环境中使用等。不过，在微服务时代，Shrio就显得力不从心了，在微服务面前和扩展方面，无法充分发展自己的优势</li></ul></li><li>开发者自定义<ul><li>也有很多公司选择自定义权限，既自己开发权限管理。但是一个系统的交全，不仅仅是登录和权限控制这么简单，我们还要考虑各种各样可能存在的网络攻击以及防御策略，从这个角度来说，开发者自己实现安全管理也并非是一件容易的事情，只有大公司才有足够的人力物力去支持这件事情</li></ul></li><li>SpringSecurity<ul><li>Spring Security作为Spring家族的一员，在和Spring家族的其他成员如Spring Boot Spring Cloud进行整合时，具有其他框架无可比拟的优势，同时对OAuth2有着良好的支持 再加上Spring Cloud对Spring Security的断加持(如 推出Spring Cloud Security),让Spring Security不知不觉中成为微服务目前的首选安全管理框架</li></ul></li></ul><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><strong>官方定义</strong></p><ul><li>官网地址 <a href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a><br>Spring Security is a powerful and highly customizabl authentication and access control framework it is the de-facto standard for securing Spring-based applications.<br>Spring Security is a framework that focuses on providing both authentication and authorization to Java applications. Like all Spring projects, the real power of Spring Security is found in how easily it can be extended to meet custom requirements<br>Spring Security是一个功能强大、 可高度定制的身份验证和访问控制框架。它是保护基于Spring的应用程序的事实标准。<br>Spring Security是一个面向Java应用程序提供身份验证和安全性的框架。与所有Spring项目一样，Spring Security的真正威力在于它可以轻松地扩展以满足定制需求。</li><li>总结<blockquote><p>Spring Security是一个功能强大、 可高度定制的身份验证和访问控制的框架。或者说用来实现系统中权限管理的框架。</p></blockquote><h3 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h3>在<spring security="">的架构设计中， 认证<authentication>和授权<authorizat ion="">是分开的，无论使用什么样的认证方式。都不会影响授权，这是两个独立的存在，这种独立带来的好处之一，就是可以非常方便地整合一些外部的解决方案。<br><a href="https://imgtu.com/i/bBm4Z4"><img src="https://s1.ax1x.com/2022/03/06/bBm4Z4.png" alt="bBm4Z4.png"></a><h4 id="认证-1"><a href="#认证-1" class="headerlink" title="认证"></a>认证</h4></authorizat></authentication></spring></li></ul><p><strong>AuthenticationManager</strong><br>在Spring Security中认证是由AuthenticationManager接口来负责的,接口定义为<br><a href="https://imgtu.com/i/bBmLQK"><img src="https://s1.ax1x.com/2022/03/06/bBmLQK.png" alt="bBmLQK.png"></a></p><ul><li>返回Authentication 表示认证成功</li><li>返回AuthenticationException异常，表示认证失败<br>AuthenticationManager主要实现类为ProvilerManager, 在ProviderManager中管理了众多AuthenticationProvider实例。在一次完整的认证流程中， Spring Security允许存在多个<br>AuthenticationProvider，用来实现多种认证方式，这些AuthenticationProvider都是由ProviderManager进行统一管理的<br><a href="https://imgtu.com/i/bBnZwQ"><img src="https://s1.ax1x.com/2022/03/06/bBnZwQ.png" alt="bBnZwQ.png"></a></li><li><em>Authentication</em>*<br>认证以及认证成功的信息主要是由Authentication的实现类进行保存的,其接口定义为:<br><a href="https://imgtu.com/i/bBnKWq"><img src="https://s1.ax1x.com/2022/03/06/bBnKWq.png" alt="bBnKWq.png"></a><br>public interface Authentication extends Principal, Serializable {<br>   Collection&lt;? extends GrantedAuthority&gt; getAuthorities();<br>   Object getCredentials();<br>   Object getDetails();<br>   Object getPrincipal();<br>   boolean isAuthenticated();<br>   void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException;<br>}</li><li>getAuthorities 获取用户权限信息</li><li>getCredentials 获取用户凭证信息，一般指密码</li><li>getDetails 获取用户详细信息</li><li>getPrincipal 获取用户身份信息，用户名、用户对象等</li><li>isAuthenticated 用户是否认证成功</li></ul><h3 id="SecurityContextHolder"><a href="#SecurityContextHolder" class="headerlink" title="SecurityContextHolder"></a>SecurityContextHolder</h3><p>SecurityContextHolder 用来获取登录之后用户信息。Spring Security 会将登录用户数据保存在 Session 中。但是，为了使用方便,Spring Security在此基础上还做了一些改进，其中最主要的一个变化就是线程绑定。当用户登录成功后,Spring Security 会将登录成功的用户信息保存到 SecurityContextHolder 中。SecurityContextHolder 中的数据保存默认是通过ThreadLocal 来实现的，使用 ThreadLocal 创建的变量只能被当前线程访问，不能被其他线程访问和修改，也就是用户数据和请求线程绑定在一起。当登录请求处理完毕后，Spring Security 会将 SecurityContextHolder 中的数据拿出来保存到 Session 中，同时将 SecurityContexHolder 中的数据清空。以后每当有请求到来时，Spring Security 就会先从 Session 中取出用户登录数据，保存到 SecurityContextHolder 中，方便在该请求的后续处理过程中使用，同时在请求结束时将 SecurityContextHolder 中的数据拿出来保存到 Session 中，然后将 Security SecurityContextHolder 中的数据清空。这一策略非常方便用户在 Controller、Service 层以及任何代码中获取当前登录用户数据。</p><h3 id="授权-1"><a href="#授权-1" class="headerlink" title="授权"></a>授权</h3><p>当完成认证后，接下米就是授权了。在 Spring Security 的授权体系中，有两个关键接口，<br><strong>AccessDecisionManager</strong></p><blockquote><p>AccessDecisionManager (访问决策管理器)，用来决定此次访问是否被允许</p></blockquote><p><a href="https://imgtu.com/i/bBn0l6"><img src="https://s1.ax1x.com/2022/03/06/bBn0l6.png" alt="bBn0l6.png"></a><br><strong>AccessDecisionVoter</strong></p><blockquote><p>AccessDecisionVoter (访问决定投票器)，投票器会检查用户是否具备应有的角色，进而投出赞成、反对或者弃权票。</p></blockquote><p><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306025901.png"></p><blockquote><p>AccesDecisionVoter 和 AccessDecisionManager 都有众多的实现类，在 AccessDecisionManager 中会换个遍历 AccessDecisionVoter，进而决定是否允许用户访问，因而 AaccesDecisionVoter 和 AccessDecisionManager 两者的关系类似于 AuthenticationProvider 和 ProviderManager 的关系。</p></blockquote><p><strong>ConfigAttribute</strong></p><blockquote><p>ConfigAttribute，用来保存授权时的角色信息</p></blockquote><p><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306025957.png"></p><blockquote><p>在 Spring Security 中，用户请求一个资源(通常是一个接口或者一个 Java 方法)需要的角色会被封装成一个 ConfigAttribute 对象，在 ConfigAttribute 中只有一个 getAttribute方法，该方法返回一个 String 字符串，就是角色的名称。一般来说，角色名称都带有一个 ROLE_ 前缀，投票器 AccessDecisionVoter 所做的事情，其实就是比较用户所具各的角色和请求某个 资源所需的 ConfigAtuibute 之间的关系。</p></blockquote><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><ul><li>Spring Boot</li><li>Spring Security<ul><li>认证：判断用户是否是系统合法用户过程</li><li>授权：判断系统内用户可以访问或具有访问那些资源权限过程</li></ul></li><li><em>创建项目</em>*<blockquote><p>1创建SpringBoot项目</p></blockquote></li></ul><p><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306031324.png"></p><blockquote><p>2创建 controller</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController {</span><br><span class="line">    @GetMapping("hello")</span><br><span class="line">    public String  hello(){</span><br><span class="line">        System.out.println("hello Security");</span><br><span class="line">        return "hello Security";</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>启动项目进行调试</p><h3 id="整合Spring-Security"><a href="#整合Spring-Security" class="headerlink" title="整合Spring Security"></a>整合Spring Security</h3><p>1 引入Spring Security相关依赖</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure><p>2 在次启动项目</p><ul><li>1.启动完成后控制台生成一个密码</li><li>2.访问hello发现直接跳转到登录页面</li></ul><p><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306032740.png"><br>3 登录系统<br>默认用户名为：user<br>默认密码为: 控制台打印的uuid<br><strong>这就是Spring Security的强大之处，只需要引入一个依赖，所有的接口就会自动保护起来!</strong></p><ul><li>为什么引入Spring Security之后 <strong>没有任何配置所有请求都要认证呐</strong></li><li>在项目中明明没有登录界面，登录界面怎么来的呢?</li><li>为什么使用user和控制台密码能登陆，登录时验证数据源存在哪里呢?</li></ul><h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p><a href="https://docs.spring.io/spring-security/site/docs/5.5.4/reference/html5/#servlet-architecture">https://docs.spring.io/spring-security/site/docs/5.5.4/reference/html5/#servlet-architecture</a><br>虽然开发者只需要引入-个依赖，就可以让Spring Security对应用进行保护。SpringSecurity又是如何做到的呢?<br>在Spring Security中认证、授权等功能都是基于过滤器完成的。<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306034230.png"><br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306034254.png"><br>需要注意的是，默认过滤器并不是直接放在Web项目的原生过滤器链中，而是通过一个FlterChainProxy来统干管理。Spring Security中的过滤器链通过FilterChainProxy 嵌入到<br>Web项目的原生过滤器链中。FilterChainProxy 作为一一个顶层的管理者，将统一管理 Security Fiter FilterChainProxy 本身是通过Spring 框架提供DelegatingFilterProxy整合到原生的过滤器链中</p><h3 id="Security-Filters"><a href="#Security-Filters" class="headerlink" title="Security Filters"></a>Security Filters</h3><p>那么在Spring Security中给我们提供那些过滤器?默认情况下那些过滤器会被加载呢?<br>|  过滤器 |  过滤器作用 |  默认是否加载 |<br>|  ChannelProcessingFilter  | 过滤请求协议 HTTP 、HTTPS |   No    |<br>|  WebAsyncManagerIntegrationFilter |  将 WebAsyncManger 与 SpringSecurity 上下文进行集成     |  YES |<br>|  SecurityContextPersistenceFilter |  在处理请求之前,将安全信息加载到 SecurityContextHolder 中         |  YES |<br>|  HeaderWriterFilter |  处理头信息加入响应中     |  YES |<br>|  CorsFilter |  处理跨域问题     |  NO |<br>|  CsrfFilter |  处理 CSRF 攻击     |  YES |<br>|  LogoutFilter |  处理注销登录     |  YES |<br>|  OAuth2AuthorizationRequestRedirectFilter |  处理 OAuth2 认证重定向 |  NO |<br>|  Saml2WebSsoAuthenticationRequestFilter |  处理 SAML 认证     |  NO |<br>|  X509AuthenticationFilter |  处理 X509 认证     |  NO |<br>|  AbstractPreAuthenticatedProcessingFilter |  处理预认证问题 |  NO  |<br>|  CasAuthenticationFilter |  处理 CAS 单点登录     |  NO |<br>|  OAuth2LoginAuthenticationFilter |  处理 OAuth2 认证     |  NO |<br>|  Saml2WebSsoAuthenticationFilter |  处理 SAML 认证     |  NO |<br>|  UsernamePasswordAuthenticationFilter |  处理表单登录     |  YES |<br>|  OpenIDAuthenticationFilter |  处理 OpenID 认证     |  NO |<br>|  DefaultLoginPageGeneratingFilter |  配置默认登录页面     |  YES |<br>|  DefaultLogoutPageGeneratingFilter |  配置默认注销页面     |  YES |<br>|  ConcurrentSessionFilter |  处理 Session 有效期     |  NO |<br>|  DigestAuthenticationFilter |  处理 HTTP 摘要认证     |  NO |<br>|  BearerTokenAuthenticationFilter |  处理 OAuth2 认证的 Access Token     |  NO |<br>|  BasicAuthenticationFilter |  处理 HttpBasic 登录     |  YES |<br>|  RequestCacheAwareFilter | 处理请求缓存     |  YES |<br>|  SecurityContextHolder /AwareRequestFilter |  包装原始请求     |  YES |<br>|  JaasApiIntegrationFilter | 处理 JAAS 认证     |  NO |<br>| RememberMeAuthenticationFilter |  处理 RememberMe 登录     |  NO |<br>|  AnonymousAuthenticationFilter |  配置匿名认证     |  YES |<br>| OAuth2AuthorizationCodeGrantFilter |  处理OAuth2认证中授权码     |  NO |<br>|  SessionManagementFilter |  处理 session 并发问题     |  YES |<br>|  ExceptionTranslationFilter |  处理认证/授权中的     |  YES |<br>| FilterSecurityInterceptor |  处理授权相关 |  YES |<br>|  SwitchUserFilter | 处理账户切换     |  NO |<br>可以看出，Spring Security 提供了 30 多个过滤器。默认情况下Spring Boot 在对 Spring Security 进入自动化配置时，会创建一个名为 SpringSecurityFilerChain 的过滤器，并注入到 Spring 容器中，这个过滤器将负责所有的安全管理，包括用户认证、授权、重定向到登录页面等。具体可以参考WebSecurityConfiguration的源码:<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306041109.png"><br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306041616.png"><br><strong>SpringBootWebSecurityConfiguration</strong><br>这个类是spring boot自动配置类，通过这个源码得知，默认情况下对所有请求进行权限控制:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Configuration(proxyBeanMethods = false)</span><br><span class="line">@ConditionalOnDefaultWebSecurity</span><br><span class="line">@ConditionalOnWebApplication(type = Type.SERVLET)</span><br><span class="line">class SpringBootWebSecurityConfiguration {</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">@Order(SecurityProperties.BASIC_AUTH_ORDER)</span><br><span class="line">SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {</span><br><span class="line">http.authorizeRequests().anyRequest().authenticated().and().formLogin().and().httpBasic();</span><br><span class="line">return http.build();</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><strong>这就是为什么在引入Spring Security中没有任何配置情况下，请求会被拦截的原因! “</strong><br>通过上面对自动配置分析，我们也能看出默认生效条件为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class DefaultWebSecurityCondition extends AllNestedConditions {</span><br><span class="line">    DefaultWebSecurityCondition() {</span><br><span class="line">        super(ConfigurationPhase.REGISTER_BEAN);</span><br><span class="line">    }</span><br><span class="line">    @ConditionalOnClass({ SecurityFilterChain.class, HttpSecurity.class })</span><br><span class="line">    static class Classes {</span><br><span class="line">    }</span><br><span class="line">    @ConditionalOnMissingBean({ WebSecurityConfigurerAdapter.class, SecurityFilterChain.class })</span><br><span class="line">    static class Beans {</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>条件一 classpath中存在 SecurityFilterChain.class, HttpSecurity.class</li><li>条件二 没有自定义 WebSecurityConfigurerAdapter.class, SecurityFilterChain.class<br>默认情况下，条件都是满足的。WebSecurityConfigurerAdapter 这个类极其重要，Spring核心配置都在这个类中:<br><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306043210.png"><h3 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h3><img src="https://beishengyi.oss-cn-beijing.aliyuncs.com/2022/03/06/QQ%E6%88%AA%E5%9B%BE20220306043913.png"></li></ul><p>1.请求 /hello接口，在引入spring security之后会先经过一些列过滤器<br>2.在请求到达FilterSecurityInterceptor时，发现请求并未认证。请求拦截下来，并抛出AccessDeniedException异常。<br>3.抛出 AccessDeniedException的异常会被ExceptionTranslationFilter捕获，这个Filter中会调用LoginUrlAuthenticationEntryPointtconpmence方法给客户端返回302，要求客户端进行重定向到/login页面<br>4.客户端发送 /login请求。<br>5 login 请求会再次被拦截器中DefautLoginPageGeneratingFilter拦截到，并在拦截器中返回生成登录页面。</p><p><strong>就是通过这种方式，Spring Security默认讨滤器中生成了登录页面，井返回!</strong></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring5框架</title>
      <link href="/2022/02/12/spring/"/>
      <url>/2022/02/12/spring/</url>
      
        <content type="html"><![CDATA[<h2 id="1、Spring框架概述"><a href="#1、Spring框架概述" class="headerlink" title="1、Spring框架概述"></a>1、Spring框架概述</h2><p><strong>1、Spring是轻量级的开源的 JavaEE框架</strong></p><p><strong>2、Spring可以解决企业应用开发的复杂性</strong></p><p><strong>3、Spring有两个核心部分：IOC 和 AOP</strong><br>(1) IOC: 控制反转,把创建对象工程交给Spring进行管理</p><p>(2) Aop: 面向切面,不修改源代码进行功能增强</p><p><strong>4、Spring特点</strong><br>(1) 方便解耦,简化开发</p><p>(2) Aop编程支持</p><p>(3) 方便程序测试</p><p>(4) 方便和其他框架进行整合</p><p>(5) 方便进行事务操作</p><p>(5) 降低API开发难度</p><p><strong>5、现在课程中,选取Spring版本5.x</strong><br><strong>### 入门案列</strong><br><strong>1、下载Spring5</strong><br>(1) 使用Spring最新版本5.3.15<br><a href="https://imgtu.com/i/HwcHtU"><img src="https://s4.ax1x.com/2022/02/12/HwcHtU.png" alt="HwcHtU.png"></a><br>(2)下载地址<br><a href="https://repo.spring.io/ui/native/release/org/springframework/spring">https://repo.spring.io/ui/native/release/org/springframework/spring</a><br><strong>2、打开idea工具 创建Java普通工程</strong><br><strong>3、导入Spring相关jar包</strong><br><a href="https://imgtu.com/i/HwRMlQ"><img src="https://s4.ax1x.com/2022/02/12/HwRMlQ.png" alt="HwRMlQ.png"></a><br><strong>4、创建普通类,在这个类创建普通方法</strong><br>   public void add(){<br>        System.out.println(“addd…..”);<br>    }<br><strong>5、创建Spring配置文件，在配置文件配置创建的对象</strong></p><pre><code>    &lt;!--配置User对象创建--&gt;    &lt;bean id="user" class="com.atwc.spring5.User"&gt;&lt;/bean&gt;</code></pre><p>(1) Spring配置文件使用xml格式<br><strong>6、进行测试代码编写</strong><br> @Test<br>    public void test(){<br>        //加载配置文件bean.xml<br>        ApplicationContext context=new ClassPathXmlApplicationContext(“bean.xml”);<br>        //获取配置文件创建的对象<br>        User user = context.getBean(“user”, User.class);<br>        System.out.println(user);<br>        user.add();<br>    }</p><h2 id="2、IOC容器"><a href="#2、IOC容器" class="headerlink" title="2、IOC容器"></a>2、IOC容器</h2><p><strong>IOC(概念和原理)</strong><br><strong>1、什么是IOC</strong><br>(1) 控制反转, 把对象创建和对象之间的调用过程,交给Spring进行管理<br>(2) 使用IOC目的: 为了耦合度降低<br>(3) 做入门案列就是IOC实现</p><p><strong>2、IOC底层原理</strong><br>(1) xml解析、工厂模式、反射</p><p><strong>3、画图讲解IOC</strong><br><a href="https://imgtu.com/i/Hw4k38"><img src="https://s4.ax1x.com/2022/02/12/Hw4k38.png" alt="Hw4k38.png"></a></p><h3 id="IOC-接口"><a href="#IOC-接口" class="headerlink" title="IOC(接口)"></a>IOC(接口)</h3><p><strong>1、IOC思想基于IOC容器完成，IOC容器底层就是对象工厂</strong><br><strong>2、Spring提供IOC容器实现两种方式：（两个接口）</strong><br>(1)BeanFactory: IOC容器基本实现,是Spring内部的使用接口，不提供开发人员进行使用<br>加载配置文件时候不会创建对象，在获取对象或者使用对象的时候才会创建对象<br>(2)ApplicationContext: BeanFactory接口的子接口，提供更多强大的功能，一般由开发人员进行使用<br>加载配置文件时候就会把在配置文件对象进行创建<br><strong>3、ApplicationContext接口实现类</strong><br><a href="https://imgtu.com/i/Hw4x2T"><img src="https://s4.ax1x.com/2022/02/12/Hw4x2T.png" alt="Hw4x2T.png"></a><br><strong>1、什么是Bean管理</strong><br>(0) Bean管理指的是两个操作<br>(1) Spring创建对象<br>(2) Spring注入属性<br><strong>2、Bean管理操作由两种方式</strong><br>(1) 基于xml配置文件方式实现<br>(2) 基于注解方式实现</p><h3 id="IOC操作Bean管理-基于XMl方式"><a href="#IOC操作Bean管理-基于XMl方式" class="headerlink" title="IOC操作Bean管理(基于XMl方式)"></a>IOC操作Bean管理(基于XMl方式)</h3><p><strong>1、基于xml方式创建对象</strong><br>(1) 在Spring配置文件中，使用bean标签 标签里面添加对应属性，就可以实现对象创建<br>(2) 在bean标签有很多属性，介绍常用的属性<br>id属性:唯一标识<br>class属性: 类全路径(包类路径)<br>name属性: 可以加特殊符号<br>(3) 创建对象时候，默认也是执行无参数构造<br><strong>2、基于xml方式注入属性</strong><br>(1) DI:依赖注入，就是注入属性<br>3、第一种注入方式：使用set方法进行注入<br>(1) 创建类，定义属性和对应的set方法<br>public class Book {<br>    private String bname;<br>    private String bauthor;<br>    public void setBname(String bname) {<br>        this.bname = bname;<br>    }<br>    public void setBauthor(String bauthor) {<br>        this.bauthor = bauthor;<br>    }</p><pre><code>@Overridepublic String toString() {    return "Book{" +            "bname='" + bname + '\'' +            ", bauthor='" + bauthor + '\'' +            '}';}</code></pre><p>}<br>(2) 在Spring配置文件配置对象创建，配置属性注入<br>   <!--2 set方法注入属性--><br>    bean id=”book” class=”com.atwc.spring5.Book”<br>        <!--使用property完成属性注入        name: 类里面属性名称        value:向属性注入的值        --><br>        property name=”bname” value=”卧槽”property<br>        property name=”bauthor” value=”我操”property<br>    bean<br>4、第二种注入方式: 使用有参数构造进行注入<br>(1) 创建类，定义属性 创建有参构造方法<br>public class Orders {<br>    private String oname;<br>    private String ovalue;<br>    public Orders(String oname,String ovalue){<br>        this.oname=oname;<br>        this.ovalue=ovalue;<br>    }<br>    @Override<br>    public String toString() {<br>        return “Orders{“ +<br>                “oname=’” + oname + ‘'‘ +<br>                “, ovalue=’” + ovalue + ‘'‘ +<br>                ‘}’;<br>    }<br>}<br>(2) 在Spring配置文件中 进行配置<br>  bean id=”order” class=”com.atwc.spring5.Orders”&gt;<br>       constructor-arg name=”oname” value=”1”&gt;constructor-arg<br>       constructor-arg name=”ovalue” value=”2”&gt;constructor-arg<br>  bean<br>5、p名称空间注入<br>(1) 使用p名称空间注入，可以简化基于xml配置方式<br>第一步 添加p名称空间在配置文件中<br>第二部 进行属性注入，在bean标签里面进行操作</p><h3 id="IOC操作Bean管理-xml注入其他类型属性"><a href="#IOC操作Bean管理-xml注入其他类型属性" class="headerlink" title="IOC操作Bean管理(xml注入其他类型属性)"></a>IOC操作Bean管理(xml注入其他类型属性)</h3><p>1、字面量<br>(1) null值<br>用null标签<br>(2) 属性值包含特殊符号<br>![CDATA[&lt;&lt;值&gt;&gt;]]<br>2、注入属性-外部bean<br>(1) 创建两个类 service类和dao类<br>(2) 在service调用dao里面的方法<br>(3) 在spring配置文件中进行配置<br>3、注入属性-内部bean和级联赋值<br>(1) 一对多关系：部门和员工<br>一个部门有多个员工，一个员工属于一个部门<br>部门是一，员工是多<br>(2) 在实体类之间表示一对多关系<br>4、注入属性-级联赋值</p><h3 id="IOC操作Bean管理（xml注入集合属性）"><a href="#IOC操作Bean管理（xml注入集合属性）" class="headerlink" title="IOC操作Bean管理（xml注入集合属性）"></a>IOC操作Bean管理（xml注入集合属性）</h3><p>1、注入数组类型属性</p><p>2、注入List集合类型属性</p><p>3、注入Map集合类型属性<br>(1) 创建类，定义数组，list,map,set类型属性 生成对应set方法<br>(2) 在spring配置文件进行配置<br>4、在集合里面设置对象类型值<br>property name=”list”<br>               list<br>                   ref bean=”course1”&gt;ref<br>                   ref bean=”course2”&gt;ref<br>               list<br>            property<br>5、把集合注入部分提取出来</p><h3 id="IOC操作Bean管理-FactoryBean"><a href="#IOC操作Bean管理-FactoryBean" class="headerlink" title="IOC操作Bean管理(FactoryBean)"></a>IOC操作Bean管理(FactoryBean)</h3><p>1、Spring有两种类型bean,一种普通bean,另外一种工厂bean(FactoryBean)</p><p>2、普通Bean: 在配置文件中定义bean类型就是返回类型</p><p>3、工厂bean: 在配置文件定义bean类型可以和返回类型不一样<br>第一步 创建类，让这个类作为工厂bean,实现接口FactoryBean<br>第二步 实现接口里面的方法，在实现的方法中定义返回的bean类型</p><h3 id="IOC操作Bean管理-Bean作用域"><a href="#IOC操作Bean管理-Bean作用域" class="headerlink" title="IOC操作Bean管理(Bean作用域)"></a>IOC操作Bean管理(Bean作用域)</h3><p>1、在Spring里面，设置创建bean实列是单实例还是多实列<br>2、在Spring里面，默认情况下，bean是单实例对象<br>设置单多实列scope: singleton 单实例 prototype 多实列  </p><h3 id="IOC操作Bean管理-Bean生命周期"><a href="#IOC操作Bean管理-Bean生命周期" class="headerlink" title="IOC操作Bean管理(Bean生命周期)"></a>IOC操作Bean管理(Bean生命周期)</h3>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Mysql基础搭建</title>
      <link href="/2021/11/21/mysql-ji-chu-da-jian/"/>
      <url>/2021/11/21/mysql-ji-chu-da-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQL环境搭建"><a href="#MySQL环境搭建" class="headerlink" title="MySQL环境搭建"></a>MySQL环境搭建</h1><hr><h2 id="1-MySQL的卸载"><a href="#1-MySQL的卸载" class="headerlink" title="1. MySQL的卸载"></a>1. MySQL的卸载</h2><h3 id="步骤1：停止MySQL服务"><a href="#步骤1：停止MySQL服务" class="headerlink" title="步骤1：停止MySQL服务"></a>步骤1：停止MySQL服务</h3><p>在卸载之前，先停止MySQL8.0的服务。按键盘上的“Ctrl + Alt + Delete”组合键，打开“任务管理器”对话框，可以在“服务”列表找到“MySQL8.0”的服务，如果现在“正在运行”状态，可以右键单击服务，选择“停止”选项停止MySQL8.0的服务，如图所示。</p><p><img src="https://z3.ax1x.com/2021/11/21/IXF3rT.png"></p><h3 id="步骤2：软件的卸载"><a href="#步骤2：软件的卸载" class="headerlink" title="步骤2：软件的卸载"></a>步骤2：软件的卸载</h3><p><strong>方式1：通过控制面板方式</strong></p><p>卸载MySQL8.0的程序可以和其他桌面应用程序一样直接在“控制面板”选择“卸载程序”，并在程序列表中找到MySQL8.0服务器程序，直接双击卸载即可，如图所示。这种方式删除，数据目录下的数据不会跟着删除。</p><p><img src="https://z3.ax1x.com/2021/11/21/IXF8qU.png"></p><p><strong>方式2：通过360或电脑管家等软件卸载</strong></p><p>略</p><p><strong>方式3：通过安装包提供的卸载功能卸载</strong></p><p>你也可以通过安装向导程序进行MySQL8.0服务器程序的卸载。</p><p>① 再次双击下载的mysql-installer-community-8.0.26.0.msi文件，打开安装向导。安装向导会自动检测已安装的MySQL服务器程序。</p><p>② 选择要卸载的MySQL服务器程序，单击“Remove”（移除），即可进行卸载。</p><p><img src="https://z3.ax1x.com/2021/11/21/IXFYa4.png"></p><p>③ 单击“Next”（下一步）按钮，确认卸载。</p><p><img src="https://z3.ax1x.com/2021/11/21/IXFtIJ.png"></p><p>④ 弹出是否同时移除数据目录选择窗口。如果想要同时删除MySQL服务器中的数据，则勾选“Remove the data directory”，如图所示。</p><img src="https://z3.ax1x.com/2021/11/21/IXFUi9.png" alt="" style="zoom:80%;"><p>⑤ 执行卸载。单击“Execute”（执行）按钮进行卸载。</p><img src="https://z3.ax1x.com/2021/11/21/IXFdR1.png" alt="" style="zoom:90%;"><p>⑥ 完成卸载。单击“Finish”（完成）按钮即可。如果想要同时卸载MySQL8.0的安装向导程序，勾选“Yes，Uninstall MySQL Installer”即可，如图所示。</p><img src="https://z3.ax1x.com/2021/11/21/IXFwxx.png" alt="" style="zoom:80%;"><h3 id="步骤3：残余文件的清理"><a href="#步骤3：残余文件的清理" class="headerlink" title="步骤3：残余文件的清理"></a>步骤3：残余文件的清理</h3><p>如果再次安装不成功，可以卸载后对残余文件进行清理后再安装。</p><p>（1）服务目录：mysql服务的安装目录</p><p>（2）数据目录：默认在C:\ProgramData\MySQL</p><p>如果自己单独指定过数据目录，就找到自己的数据目录进行删除即可。</p><blockquote><p>注意：请在卸载前做好数据备份</p><p>在操作完以后，需要重启计算机，然后进行安装即可。<strong>如果仍然安装失败，需要继续操作如下步骤4。</strong></p></blockquote><h3 id="步骤4：清理注册表（选做）"><a href="#步骤4：清理注册表（选做）" class="headerlink" title="步骤4：清理注册表（选做）"></a>步骤4：清理注册表（选做）</h3><p>如果前几步做了，再次安装还是失败，那么可以清理注册表。</p><p>如何打开注册表编辑器：在系统的搜索框中输入<code>regedit</code></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Eventlog\Application\MySQL服务 目录删除</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\MySQL服务 目录删除</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Services\Eventlog\Application\MySQL服务 目录删除</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Services\MySQL服务 目录删除</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application\MySQL服务目录删除</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MySQL服务删除</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注册表中的ControlSet001,ControlSet002,不一定是001和002,可能是ControlSet005、006之类</p></blockquote><h3 id="步骤5：删除环境变量配置"><a href="#步骤5：删除环境变量配置" class="headerlink" title="步骤5：删除环境变量配置"></a>步骤5：删除环境变量配置</h3><p>找到path环境变量，将其中关于mysql的环境变量删除，<strong>切记不要全部删除。</strong></p><p>例如：删除  D:\develop_tools\mysql\MySQLServer8.0.26\bin;  这个部分</p><p><img src="https://z3.ax1x.com/2021/11/21/IXFcIH.png"></p><h2 id="2-MySQL的下载、安装、配置"><a href="#2-MySQL的下载、安装、配置" class="headerlink" title="2. MySQL的下载、安装、配置"></a>2. MySQL的下载、安装、配置</h2><h3 id="2-1-MySQL的4大版本"><a href="#2-1-MySQL的4大版本" class="headerlink" title="2.1 MySQL的4大版本"></a>2.1 MySQL的4大版本</h3><blockquote><ul><li><p><strong>MySQL Community Server 社区版本</strong>，开源免费，自由下载，但不提供官方技术支持，适用于大多数普通用户。</p></li><li><p><strong>MySQL Enterprise Edition 企业版本</strong>，需付费，不能在线下载，可以试用30天。提供了更多的功能和更完备的技术支持，更适合于对数据库的功能和可靠性要求较高的企业客户。</p></li><li><p><strong>MySQL Cluster 集群版</strong>，开源免费。用于架设集群服务器，可将几个MySQL Server封装成一个Server。需要在社区版或企业版的基础上使用。</p></li><li><p><strong>MySQL Cluster CGE 高级集群版</strong>，需付费。</p></li></ul></blockquote><ul><li>目前最新版本为<code>8.0.27</code>，发布时间<code>2021年10月</code>。此前，8.0.0 在 2016.9.12日就发布了。</li></ul><ul><li>本课程中使用<code>8.0.26版本</code>。</li></ul><p>此外，官方还提供了<code>MySQL Workbench</code>（GUITOOL）一款专为MySQL设计的<code>图形界面管理工具</code>。MySQLWorkbench又分为两个版本，分别是<code>社区版</code>（MySQL Workbench OSS）、<code>商用版</code>（MySQL WorkbenchSE）。</p><h3 id="2-2-软件的下载"><a href="#2-2-软件的下载" class="headerlink" title="2.2 软件的下载"></a>2.2 软件的下载</h3><p><strong>1. 下载地址</strong></p><p>官网：<a href="https://www.mysql.com/">https://www.mysql.com</a></p><p><strong>2. 打开官网，点击DOWNLOADS</strong></p><p>然后，点击<code>MySQL Community(GPL) Downloads</code></p><p><img src="https://z3.ax1x.com/2021/11/21/IXF2id.png"></p><p><strong>3. 点击 MySQL Community Server</strong></p> <img src="https://z3.ax1x.com/2021/11/21/IXFRJA.png" alt="" style="zoom:80%;"><p><strong>4. 在General Availability(GA) Releases中选择适合的版本</strong></p><p>Windows平台下提供两种安装文件：MySQL二进制分发版（.msi安装文件）和免安装版（.zip压缩文件）。一般来讲，应当使用二进制分发版，因为该版本提供了图形化的安装向导过程，比其他的分发版使用起来要简单，不再需要其他工具启动就可以运行MySQL。</p><ul><li>这里在Windows 系统下推荐下载<code>MSI安装程序</code>；点击<code>Go to Download Page</code>进行下载即可</li></ul> <img src="https://z3.ax1x.com/2021/11/21/IXFWRI.png" alt="" style="zoom:67%;"><p> <img src="https://z3.ax1x.com/2021/11/21/IXF4QP.png"></p><ul><li>Windows下的MySQL8.0安装有两种安装程序<ul><li><code>mysql-installer-web-community-8.0.26.0.msi</code> 下载程序大小：2.4M；安装时需要联网安装组件。</li><li><code>mysql-installer-community-8.0.26.0.msi</code> 下载程序大小：450.7M；安装时离线安装即可。<strong>推荐。</strong></li></ul></li><li>如果安装MySQL5.7版本的话，选择<code>Archives</code>，接着选择MySQL5.7的相应版本即可。这里下载最近期的MySQL5.7.34版本。</li></ul><p> <img src="https://z3.ax1x.com/2021/11/21/IXFIL8.png"></p><p><img src="https://z3.ax1x.com/2021/11/21/IXFTeS.png"></p><h3 id="2-3-MySQL8-0-版本的安装"><a href="#2-3-MySQL8-0-版本的安装" class="headerlink" title="2.3 MySQL8.0 版本的安装"></a>2.3 MySQL8.0 版本的安装</h3><p>MySQL下载完成后，找到下载文件，双击进行安装，具体操作步骤如下。</p><p>步骤1：双击下载的mysql-installer-community-8.0.26.0.msi文件，打开安装向导。</p><p>步骤2：打开“Choosing a Setup Type”（选择安装类型）窗口，在其中列出了5种安装类型，分别是Developer Default（默认安装类型）、Server only（仅作为服务器）、Client only（仅作为客户端）、Full（完全安装）、Custom（自定义安装）。这里选择“Custom（自定义安装）”类型按钮，单击“Next(下一步)”按钮。</p><img src="https://z3.ax1x.com/2021/11/21/IXF7dg.png" alt="" style="zoom:90%;"><p>步骤3：打开“Select Products” （选择产品）窗口，可以定制需要安装的产品清单。例如，选择“MySQL Server 8.0.26-X64”后，单击“→”添加按钮，即可选择安装MySQL服务器，如图所示。采用通用的方法，可以添加其他你需要安装的产品。</p><img src="https://z3.ax1x.com/2021/11/21/IXFqij.png" alt="" style="zoom:80%;"><p>此时如果直接“Next”（下一步），则产品的安装路径是默认的。如果想要自定义安装目录，则可以选中对应的产品，然后在下面会出现“Advanced Options”（高级选项）的超链接。</p><img src="https://z3.ax1x.com/2021/11/21/IXFLJs.png" alt="" style="zoom:80%;"><p>单击“Advanced Options”（高级选项）则会弹出安装目录的选择窗口，如图所示，此时你可以分别设置MySQL的服务程序安装目录和数据存储目录。如果不设置，默认分别在C盘的Program Files目录和ProgramData目录（这是一个隐藏目录）。如果自定义安装目录，请避免“中文”目录。另外，建议服务目录和数据目录分开存放。</p><img src="https://z3.ax1x.com/2021/11/21/IXFOWn.png" alt="" style="zoom:80%;"><p>步骤4：在上一步选择好要安装的产品之后，单击“Next”（下一步）进入确认窗口，如图所示。单击“Execute”（执行）按钮开始安装。</p><img src="https://z3.ax1x.com/2021/11/21/IXFXzq.png" alt="" style="zoom:90%;"><p>步骤5：安装完成后在“Status”（状态）列表下将显示“Complete”（安装完成），如图所示。</p><img src="https://z3.ax1x.com/2021/11/21/IXFxyV.png" alt="" style="zoom:90%;"><h3 id="2-4-配置MySQL8-0"><a href="#2-4-配置MySQL8-0" class="headerlink" title="2.4 配置MySQL8.0"></a>2.4 配置MySQL8.0</h3><p>MySQL安装之后，需要对服务器进行配置。具体的配置步骤如下。</p><p>步骤1：在上一个小节的最后一步，单击“Next”（下一步）按钮，就可以进入产品配置窗口。</p><img src="https://z3.ax1x.com/2021/11/21/IXFzLT.jpg" alt="" style="zoom:80%;"><p>步骤2：单击“Next”（下一步）按钮，进入MySQL服务器类型配置窗口，如图所示。端口号一般选择默认端口号3306。</p><img src="https://z3.ax1x.com/2021/11/21/IXkpeU.jpg" alt="" style="zoom:80%;"><p>其中，“Config Type”选项用于设置服务器的类型。单击该选项右侧的下三角按钮，即可查看3个选项，如图所示。</p><img src="https://z3.ax1x.com/2021/11/21/IXk9wF.jpg" alt="" style="zoom:80%;"><ul><li><p><code>Development Machine（开发机器）</code>：该选项代表典型个人用桌面工作站。此时机器上需要运行多个应用程序，那么MySQL服务器将占用最少的系统资源。</p></li><li><p><code>Server Machine（服务器）</code>：该选项代表服务器，MySQL服务器可以同其他服务器应用程序一起运行，例如Web服务器等。MySQL服务器配置成适当比例的系统资源。</p></li><li><p><code>Dedicated Machine（专用服务器）</code>：该选项代表只运行MySQL服务的服务器。MySQL服务器配置成使用所有可用系统资源。</p></li></ul><p>步骤3：单击“Next”（下一步）按钮，打开设置授权方式窗口。其中，上面的选项是MySQL8.0提供的新的授权方式，采用SHA256基础的密码加密方法；下面的选项是传统授权方法（保留5.x版本兼容性）。</p><img src="https://z3.ax1x.com/2021/11/21/IXkCo4.jpg" alt="" style="zoom:80%;"><p>步骤4：单击“Next”（下一步）按钮，打开设置服务器root超级管理员的密码窗口，如图所示，需要输入两次同样的登录密码。也可以通过“Add User”添加其他用户，添加其他用户时，需要指定用户名、允许该用户名在哪台/哪些主机上登录，还可以指定用户角色等。此处暂不添加用户，用户管理在MySQL高级特性篇中讲解。</p><img src="https://z3.ax1x.com/2021/11/21/IXkiFJ.jpg" alt="" style="zoom:80%;"><p>步骤5：单击“Next”（下一步）按钮，打开设置服务器名称窗口，如图所示。该服务名会出现在Windows服务列表中，也可以在命令行窗口中使用该服务名进行启动和停止服务。本书将服务名设置为“MySQL80”。如果希望开机自启动服务，也可以勾选“Start the MySQL Server at System Startup”选项（推荐）。</p><p>下面是选择以什么方式运行服务？可以选择“Standard System Account”(标准系统用户)或者“Custom User”(自定义用户)中的一个。这里推荐前者。</p><img src="https://z3.ax1x.com/2021/11/21/IXkFY9.jpg" alt="" style="zoom:80%;"><p>步骤6：单击“Next”（下一步）按钮，打开确认设置服务器窗口，单击“Execute”（执行）按钮。</p><img src="https://z3.ax1x.com/2021/11/21/IXkkWR.jpg" alt="" style="zoom:80%;"><p>步骤7：完成配置，如图所示。单击“Finish”（完成）按钮，即可完成服务器的配置。</p><img src="https://z3.ax1x.com/2021/11/21/IXkES1.jpg" alt="" style="zoom:80%;"><p>步骤8：如果还有其他产品需要配置，可以选择其他产品，然后继续配置。如果没有，直接选择“Next”（下一步），直接完成整个安装和配置过程。</p><img src="https://z3.ax1x.com/2021/11/21/IXkZy6.jpg" alt="" style="zoom:80%;"><p>步骤9：结束安装和配置。</p><img src="https://z3.ax1x.com/2021/11/21/IXkeOK.jpg" alt="" style="zoom:80%;"><h3 id="2-5-配置MySQL8-0-环境变量"><a href="#2-5-配置MySQL8-0-环境变量" class="headerlink" title="2.5 配置MySQL8.0 环境变量"></a>2.5 配置MySQL8.0 环境变量</h3><p>如果不配置MySQL环境变量，就不能在命令行直接输入MySQL登录命令。下面说如何配置MySQL的环境变量：</p><p>步骤1：在桌面上右击【此电脑】图标，在弹出的快捷菜单中选择【属性】菜单命令。<br>步骤2：打开【系统】窗口，单击【高级系统设置】链接。<br>步骤3：打开【系统属性】对话框，选择【高级】选项卡，然后单击【环境变量】按钮。<br>步骤4：打开【环境变量】对话框，在系统变量列表中选择path变量。<br>步骤5：单击【编辑】按钮，在【编辑环境变量】对话框中，将MySQL应用程序的bin目录（C:\Program Files\MySQL\MySQL Server 8.0\bin）添加到变量值中，用分号将其与其他路径分隔开。<br>步骤6：添加完成之后，单击【确定】按钮，这样就完成了配置path变量的操作，然后就可以直接输入MySQL命令来登录数据库了。</p><h3 id="2-6-MySQL5-7-版本的安装、配置"><a href="#2-6-MySQL5-7-版本的安装、配置" class="headerlink" title="2.6 MySQL5.7 版本的安装、配置"></a>2.6 MySQL5.7 版本的安装、配置</h3><ul><li><strong>安装</strong></li></ul><p>此版本的安装过程与上述过程除了版本号不同之外，其它环节都是相同的。所以这里省略了MySQL5.7.34版本的安装截图。</p><ul><li><strong>配置</strong></li></ul><p>配置环节与MySQL8.0版本确有细微不同。大部分情况下直接选择“Next”即可，不影响整理使用。</p><p>这里配置MySQL5.7时，重点强调：<strong>与前面安装好的MySQL8.0不能使用相同的端口号。</strong></p><h3 id="2-7-安装失败问题"><a href="#2-7-安装失败问题" class="headerlink" title="2.7 安装失败问题"></a>2.7 安装失败问题</h3><p>MySQL的安装和配置是一件非常简单的事，但是在操作过程中也可能出现问题，特别是初学者。</p><p><strong>问题1：无法打开MySQL8.0软件安装包或者安装过程中失败，如何解决？</strong></p><p>在运行MySQL8.0软件安装包之前，用户需要确保系统中已经安装了.Net Framework相关软件，如果缺少此软件，将不能正常地安装MySQL8.0软件。</p><img src="https://z3.ax1x.com/2021/11/21/IXZpcR.gif" alt="" style="zoom:80%;"><p>解决方案：到这个地址<a href="https://www.microsoft.com/en-us/download/details.aspx?id=42642%E4%B8%8B%E8%BD%BDMicrosoft">https://www.microsoft.com/en-us/download/details.aspx?id=42642下载Microsoft</a> .NET Framework 4.5并安装后，再去安装MySQL。</p><p>另外，还要确保Windows Installer正常安装。windows上安装mysql8.0需要操作系统提前已安装好Microsoft Visual C++ 2015-2019。</p><img src="https://z3.ax1x.com/2021/11/21/IXVXAU.gif" alt="" style="zoom:75%;"><img src="https://z3.ax1x.com/2021/11/21/IXZ9j1.gif" alt="" style="zoom:75%;"><p>解决方案同样是，提前到微软官网<a href="https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0%EF%BC%8C%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%BA%94%E7%9A%84%E7%8E%AF%E5%A2%83%E3%80%82">https://support.microsoft.com/en-us/topic/the-latest-supported-visual-c-downloads-2647da03-1eea-4433-9aff-95f26a218cc0，下载相应的环境。</a></p><p><strong>问题2：卸载重装MySQL失败？</strong></p><p>该问题通常是因为MySQL卸载时，没有完全清除相关信息导致的。</p><p>解决办法是，把以前的安装目录删除。如果之前安装并未单独指定过服务安装目录，则默认安装目录是“C:\Program Files\MySQL”，彻底删除该目录。同时删除MySQL的Data目录，如果之前安装并未单独指定过数据目录，则默认安装目录是“C:\ProgramData\MySQL”，该目录一般为隐藏目录。删除后，重新安装即可。</p><p><strong>问题3：如何在Windows系统删除之前的未卸载干净的MySQL服务列表？</strong></p><p>操作方法如下，在系统“搜索框”中输入“cmd”，按“Enter”（回车）键确认，弹出命令提示符界面。然后输入“sc delete MySQL服务名”,按“Enter”（回车）键，就能彻底删除残余的MySQL服务了。</p><h2 id="3-MySQL的登录"><a href="#3-MySQL的登录" class="headerlink" title="3. MySQL的登录"></a>3. MySQL的登录</h2><h3 id="3-1-服务的启动与停止"><a href="#3-1-服务的启动与停止" class="headerlink" title="3.1 服务的启动与停止"></a>3.1 服务的启动与停止</h3><p>MySQL安装完毕之后，需要启动服务器进程，不然客户端无法连接数据库。</p><p>在前面的配置过程中，已经将MySQL安装为Windows服务，并且勾选当Windows启动、停止时，MySQL也自动启动、停止。</p><h4 id="方式1：使用图形界面工具"><a href="#方式1：使用图形界面工具" class="headerlink" title="方式1：使用图形界面工具"></a>方式1：使用图形界面工具</h4><ul><li><p>步骤1：打开windows服务</p><ul><li>方式1：计算机（点击鼠标右键）→ 管理（点击）→ 服务和应用程序（点击）→ 服务（点击）</li><li>方式2：控制面板（点击）→ 系统和安全（点击）→ 管理工具（点击）→ 服务（点击）</li><li>方式3：任务栏（点击鼠标右键）→ 启动任务管理器（点击）→ 服务（点击）</li><li>方式4：单击【开始】菜单，在搜索框中输入“services.msc”，按Enter键确认 </li></ul></li><li><p>步骤2：找到MySQL80（点击鼠标右键）→ 启动或停止（点击）</p></li></ul><p><img src="https://z3.ax1x.com/2021/11/21/IXZPnx.png"></p><h4 id="方式2：使用命令行工具"><a href="#方式2：使用命令行工具" class="headerlink" title="方式2：使用命令行工具"></a>方式2：使用命令行工具</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 启动 MySQL 服务命令：</span><br><span class="line">net start MySQL服务名</span><br><span class="line"></span><br><span class="line"># 停止 MySQL 服务命令：</span><br><span class="line">net stop MySQL服务名</span><br></pre></td></tr></tbody></table></figure><img src="https://z3.ax1x.com/2021/11/21/IXZFHK.png" alt="" style="zoom:80%;"><p>说明：</p><ol><li><p>start和stop后面的服务名应与之前配置时指定的服务名一致。</p></li><li><p>如果当你输入命令后，提示“拒绝服务”，请以<code>系统管理员身份</code>打开命令提示符界面重新尝试。</p></li></ol><h3 id="3-2-自带客户端的登录与退出"><a href="#3-2-自带客户端的登录与退出" class="headerlink" title="3.2 自带客户端的登录与退出"></a>3.2 自带客户端的登录与退出</h3><p>当MySQL服务启动完成后，便可以通过客户端来登录MySQL数据库。注意：确认服务是开启的。</p><h4 id="登录方式1：MySQL自带客户端"><a href="#登录方式1：MySQL自带客户端" class="headerlink" title="登录方式1：MySQL自带客户端"></a>登录方式1：MySQL自带客户端</h4><p>开始菜单 → 所有程序 → MySQL → MySQL 8.0 Command Line Client</p><img src="https://z3.ax1x.com/2021/11/21/IXZV4e.png" alt="" style="zoom:80%;"><blockquote><p>说明：仅限于root用户</p></blockquote><h4 id="登录方式2：windows命令行"><a href="#登录方式2：windows命令行" class="headerlink" title="登录方式2：windows命令行"></a>登录方式2：windows命令行</h4><ul><li>格式：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 主机名 -P 端口号 -u 用户名 -p密码</span><br></pre></td></tr></tbody></table></figure><ul><li>举例：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -P 3306 -u root -pabc123  # 这里我设置的root用户的密码是abc123</span><br></pre></td></tr></tbody></table></figure><img src="https://z3.ax1x.com/2021/11/21/IXZe9H.png" alt="" style="zoom:80%;"><p>注意：</p><p>（1）-p与密码之间不能有空格，其他参数名与参数值之间可以有空格也可以没有空格。如：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>hlocalhost <span class="operator">-</span>P3306 <span class="operator">-</span>uroot <span class="operator">-</span>pabc123</span><br></pre></td></tr></tbody></table></figure><p>（2）密码建议在下一行输入，保证安全</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>h localhost <span class="operator">-</span>P <span class="number">3306</span> <span class="operator">-</span>u root <span class="operator">-</span>p</span><br><span class="line">Enter password:<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br></pre></td></tr></tbody></table></figure><p>（3）客户端和服务器在同一台机器上，所以输入localhost或者IP地址127.0.0.1。同时，因为是连接本机：<br>-hlocalhost就可以省略，如果端口号没有修改：-P3306也可以省略</p><p>  简写成：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p</span><br><span class="line">Enter password:<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br></pre></td></tr></tbody></table></figure><p>连接成功后，有关于MySQL Server服务版本的信息，还有第几次连接的id标识。</p><p>也可以在命令行通过以下方式获取MySQL Server服务版本的信息：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\&gt; mysql -V</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\&gt; mysql --version</span><br></pre></td></tr></tbody></table></figure><p>或<strong>登录</strong>后，通过以下方式查看当前版本信息：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br></pre></td></tr></tbody></table></figure><h4 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">或</span><br><span class="line">quit</span><br></pre></td></tr></tbody></table></figure><h2 id="4-MySQL演示使用"><a href="#4-MySQL演示使用" class="headerlink" title="4. MySQL演示使用"></a>4. MySQL演示使用</h2><h3 id="4-1-MySQL的使用演示"><a href="#4-1-MySQL的使用演示" class="headerlink" title="4.1 MySQL的使用演示"></a>4.1 MySQL的使用演示</h3><p>1、查看所有的数据库</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>“information_schema”是 MySQL 系统自带的数据库，主要保存 MySQL 数据库服务器的系统信息，比如数据库的名称、数据表的名称、字段名称、存取权限、数据文件 所在的文件夹和系统使用的文件夹，等等</p><p>“performance_schema”是 MySQL 系统自带的数据库，可以用来监控 MySQL 的各类性能指标。 </p><p>“sys”数据库是 MySQL 系统自带的数据库，主要作用是以一种更容易被理解的方式展示 MySQL 数据库服务器的各类性能指标，帮助系统管理员和开发人员监控 MySQL 的技术性能。 </p><p>“mysql”数据库保存了 MySQL 数据库服务器运行时需要的系统信息，比如数据文件夹、当前使用的字符集、约束检查信息，等等</p></blockquote><p>为什么 Workbench 里面我们只能看到“demo”和“sys”这 2 个数据库呢？ </p><p>这是因为，Workbench 是图形化的管理工具，主要面向开发人 员，“demo”和“sys”这 2 个数据库已经够用了。如果有特殊需求，比如，需要监控 MySQL 数据库各项性能指标、直接操作 MySQL 数据库系统文件等，可以由 DBA 通过 SQL 语句，查看其它的系统数据库。</p><p>2、创建自己的数据库</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名;</span><br><span class="line"></span><br><span class="line">#创建atguigudb数据库，该名称不能与已经存在的数据库重名。</span><br><span class="line">create database atguigudb;</span><br></pre></td></tr></tbody></table></figure><p>3、使用自己的数据库</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br><span class="line"></span><br><span class="line">#使用atguigudb数据库</span><br><span class="line">use atguigudb;</span><br></pre></td></tr></tbody></table></figure><p>说明：如果没有使用use语句，后面针对数据库的操作也没有加“数据名”的限定，那么会报“ERROR 1046 (3D000): No database selected”（没有选择数据库）</p><p>使用完use语句之后，如果接下来的SQL都是针对一个数据库操作的，那就不用重复use了，如果要针对另一个数据库操作，那么要重新use。</p><p>4、查看某个库的所有表格</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show tables;  #要求前面有use语句</span><br><span class="line"></span><br><span class="line">show tables from 数据库名;</span><br></pre></td></tr></tbody></table></figure><p>5、创建新的表格</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table 表名称(</span><br><span class="line">字段名  数据类型,</span><br><span class="line">字段名 数据类型</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p>说明：如果是最后一个字段，后面就用加逗号，因为逗号的作用是分割每个字段。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#创建学生表</span><br><span class="line">create table student(</span><br><span class="line">id int,</span><br><span class="line">    name varchar(20)  #说名字最长不超过20个字符</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p>6、查看一个表的数据</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 数据库表名称;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看学生表的数据</span><br><span class="line">select * from student;</span><br></pre></td></tr></tbody></table></figure><p>7、添加一条记录</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名称 values(值列表);</span><br><span class="line"></span><br><span class="line">#添加两条记录到student表中</span><br><span class="line">insert into student values(1,'张三');</span><br><span class="line">insert into student values(2,'李四');</span><br></pre></td></tr></tbody></table></figure><p>报错：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into student values(1,'张三');</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: '\xD5\xC5\xC8\xFD' for column 'name' at row 1</span><br><span class="line">mysql&gt; insert into student values(2,'李四');</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: '\xC0\xEE\xCB\xC4' for column 'name' at row 1</span><br><span class="line">mysql&gt; show create table student;</span><br></pre></td></tr></tbody></table></figure><p>字符集的问题。</p><p>8、查看表的创建信息</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show create table 表名称\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看student表的详细创建信息</span><br><span class="line">show create table student\G</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#结果如下</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line">Create Table: CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) DEFAULT NULL,</span><br><span class="line">  `name` varchar(20) DEFAULT NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><p>上面的结果显示student的表格的默认字符集是“latin1”不支持中文。</p><p>9、查看数据库的创建信息</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show create database 数据库名\G</span><br><span class="line"></span><br><span class="line">#查看atguigudb数据库的详细创建信息</span><br><span class="line">show create database atguigudb\G</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#结果如下</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Database: atguigudb</span><br><span class="line">Create Database: CREATE DATABASE `atguigudb` /*!40100 DEFAULT CHARACTER SET latin1 */</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><p>上面的结果显示atguigudb数据库也不支持中文，字符集默认是latin1。</p><p>10、删除表格</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table 表名称;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#删除学生表</span><br><span class="line">drop table student;</span><br></pre></td></tr></tbody></table></figure><p>11、删除数据库</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database 数据库名;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#删除atguigudb数据库</span><br><span class="line">drop database atguigudb;</span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-MySQL的编码设置"><a href="#4-2-MySQL的编码设置" class="headerlink" title="4.2 MySQL的编码设置"></a>4.2 MySQL的编码设置</h3><h4 id="MySQL5-7中"><a href="#MySQL5-7中" class="headerlink" title="MySQL5.7中"></a>MySQL5.7中</h4><p><strong>问题再现：命令行操作sql乱码问题</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO t_stu VALUES(1,'张三','男');</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: '\xD5\xC5\xC8\xFD' for column 'sname' at row 1</span><br></pre></td></tr></tbody></table></figure><p><strong>问题解决</strong></p><p>步骤1：查看编码命令</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like 'character_%';</span><br><span class="line">show variables like 'collation_%';</span><br></pre></td></tr></tbody></table></figure><p>步骤2：修改mysql的数据目录下的my.ini配置文件</p><figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span>  <span class="comment">#大概在63行左右，在其下添加</span></span><br><span class="line">... </span><br><span class="line"><span class="attr">default-character-set</span>=utf8  <span class="comment">#默认字符集</span></span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span>  <span class="comment"># 大概在76行左右，在其下添加</span></span><br><span class="line">...</span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br><span class="line"><span class="attr">collation-server</span>=utf8_general_ci</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意：建议修改配置文件使用notepad++等高级文本编辑器，使用记事本等软件打开修改后可能会导致文件编码修改为“含BOM头”的编码，从而服务重启失败。</p></blockquote><p>步骤3：重启服务</p><p>步骤4：查看编码命令</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">'character_%'</span>;</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">'collation_%'</span>;</span><br></pre></td></tr></tbody></table></figure><img src="https://z3.ax1x.com/2021/11/21/IXZm3d.jpg" style="zoom:90%;"><img src="https://z3.ax1x.com/2021/11/21/IXZngA.jpg" style="zoom:90%;"><ul><li>如果是以上配置就说明对了。接着我们就可以新创建数据库、新创建数据表，接着添加包含中文的数据了。</li></ul><h4 id="MySQL8-0中"><a href="#MySQL8-0中" class="headerlink" title="MySQL8.0中"></a>MySQL8.0中</h4><p>在MySQL 8.0版本之前，默认字符集为latin1，utf8字符集指向的是utf8mb3。网站开发人员在数据库设计的时候往往会将编码修改为utf8字符集。如果遗忘修改默认的编码，就会出现乱码的问题。从MySQL 8.0开始，数据库的默认编码改为<code>utf8mb4</code>，从而避免了上述的乱码问题。</p><h2 id="5-MySQL图形化管理工具"><a href="#5-MySQL图形化管理工具" class="headerlink" title="5. MySQL图形化管理工具"></a>5. MySQL图形化管理工具</h2><p>MySQL图形化管理工具极大地方便了数据库的操作与管理，常用的图形化管理工具有：MySQL Workbench、phpMyAdmin、Navicat Preminum、MySQLDumper、SQLyog、dbeaver、MySQL ODBC Connector。</p><h3 id="工具1-MySQL-Workbench"><a href="#工具1-MySQL-Workbench" class="headerlink" title="工具1. MySQL Workbench"></a>工具1. MySQL Workbench</h3><p>MySQL官方提供的图形化管理工具MySQL Workbench完全支持MySQL 5.0以上的版本。MySQL Workbench分为社区版和商业版，社区版完全免费，而商业版则是按年收费。</p><p>MySQL Workbench 为数据库管理员、程序开发者和系统规划师提供可视化设计、模型建立、以及数据库管理功能。它包含了用于创建复杂的数据建模ER模型，正向和逆向数据库工程，也可以用于执行通常需要花费大量时间的、难以变更和管理的文档任务。</p><p>下载地址：<a href="http://dev.mysql.com/downloads/workbench/%E3%80%82">http://dev.mysql.com/downloads/workbench/。</a></p><p>使用：</p><p>首先，我们点击 Windows 左下角的“开始”按钮，如果你是 Win10 系统，可以直接看到所有程序。接着，找到“MySQL”，点开，找到“MySQL Workbench 8.0 CE”。点击打开 Workbench，如下图所示：</p><p><img src="https://z3.ax1x.com/2021/11/21/IXZujI.png"></p><p>左下角有个本地连接，点击，录入 Root 的密码，登录本地 MySQL 数据库服务器，如下图所示：</p><img src="https://z3.ax1x.com/2021/11/21/IXZMut.png" alt="" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZQDP.png" alt="" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZG4g.png" alt="" style="zoom:80%;"><p>这是一个图形化的界面，我来给你介绍下这个界面。 </p><ul><li><p>上方是菜单。左上方是导航栏，这里我们可以看到 MySQL 数据库服务器里面的数据 库，包括数据表、视图、存储过程和函数；左下方是信息栏，可以显示上方选中的数据 库、数据表等对象的信息。 </p></li><li><p>中间上方是工作区，你可以在这里写 SQL 语句，点击上方菜单栏左边的第三个运行按 钮，就可以执行工作区的 SQL 语句了。 </p></li><li><p>中间下方是输出区，用来显示 SQL 语句的运行情况，包括什么时间开始运行的、运行的 内容、运行的输出，以及所花费的时长等信息。</p></li></ul><p>好了，下面我们就用 Workbench 实际创建一个数据库，并且导入一个 Excel 数据文件， 来生成一个数据表。数据表是存储数据的载体，有了数据表以后，我们就能对数据进行操作了。 </p><h3 id="工具2-Navicat"><a href="#工具2-Navicat" class="headerlink" title="工具2. Navicat"></a>工具2. Navicat</h3><p>Navicat MySQL是一个强大的MySQL数据库服务器管理和开发工具。它可以与任何3.21或以上版本的MySQL一起工作，支持触发器、存储过程、函数、事件、视图、管理用户等，对于新手来说易学易用。其精心设计的图形用户界面（GUI）可以让用户用一种安全简便的方式来快速方便地创建、组织、访问和共享信息。Navicat支持中文，有免费版本提供。<br>下载地址：<a href="http://www.navicat.com/%E3%80%82">http://www.navicat.com/。</a></p><img src="https://z3.ax1x.com/2021/11/21/IXZt3j.png" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZNgs.png" alt="" style="zoom:80%;"><h3 id="工具3-SQLyog"><a href="#工具3-SQLyog" class="headerlink" title="工具3. SQLyog"></a>工具3. SQLyog</h3><p>SQLyog 是业界著名的 Webyog 公司出品的一款简洁高效、功能强大的图形化 MySQL 数据库管理工具。这款工具是使用C++语言开发的。该工具可以方便地创建数据库、表、视图和索引等，还可以方便地进行插入、更新和删除等操作，同时可以方便地进行数据库、数据表的备份和还原。该工具不仅可以通过SQL文件进行大量文件的导入和导出，还可以导入和导出XML、HTML和CSV等多种格式的数据。<br>下载地址：<a href="http://www.webyog.com/%EF%BC%8C%E8%AF%BB%E8%80%85%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%90%9C%E7%B4%A2%E4%B8%AD%E6%96%87%E7%89%88%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%82">http://www.webyog.com/，读者也可以搜索中文版的下载地址。</a></p><img src="https://z3.ax1x.com/2021/11/21/IXZUvn.png" alt="" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZDET.png" alt="" style="zoom:80%;"><h3 id="工具4：dbeaver"><a href="#工具4：dbeaver" class="headerlink" title="工具4：dbeaver"></a>工具4：dbeaver</h3><p>DBeaver是一个通用的数据库管理工具和 SQL 客户端，支持所有流行的数据库：MySQL、PostgreSQL、SQLite、Oracle、DB2、SQL Server、 Sybase、MS Access、Teradata、 Firebird、Apache Hive、Phoenix、Presto等。DBeaver比大多数的SQL管理工具要轻量，而且支持中文界面。DBeaver社区版作为一个免费开源的产品，和其他类似的软件相比，在功能和易用性上都毫不逊色。</p><p>唯一需要注意是 DBeaver 是用Java编程语言开发的，所以需要拥有 JDK（Java Development ToolKit）环境。如果电脑上没有JDK，在选择安装DBeaver组件时，勾选“Include Java”即可。</p><p>下载地址：<a href="https://dbeaver.io/download/">https://dbeaver.io/download/</a></p><img src="https://z3.ax1x.com/2021/11/21/IXZrUU.png" alt="" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZs5F.png" alt="" style="zoom:75%;"><img src="https://z3.ax1x.com/2021/11/21/IXZc8J.png" alt="" style="zoom:80%;"><img src="https://z3.ax1x.com/2021/11/21/IXZg29.png" alt="" style="zoom:70%;"><h3 id="可能出现连接问题："><a href="#可能出现连接问题：" class="headerlink" title="可能出现连接问题："></a>可能出现连接问题：</h3><p>有些图形界面工具，特别是旧版本的图形界面工具，在连接MySQL8时出现“Authentication plugin ‘caching_sha2_password’ cannot be loaded”错误。</p><img src="https://z3.ax1x.com/2021/11/21/IXZWK1.png" alt="" style="zoom:80%;"><p>出现这个原因是MySQL8之前的版本中加密规则是mysql_native_password，而在MySQL8之后，加密规则是caching_sha2_password。解决问题方法有两种，第一种是升级图形界面工具版本，第二种是把MySQL8用户登录密码加密规则还原成mysql_native_password。</p><p>第二种解决方案如下，用命令行登录MySQL数据库之后，执行如下命令修改用户密码加密规则并更新用户密码，这里修改用户名为“root@localhost”的用户密码规则为“mysql_native_password”，密码值为“123456”，如图所示。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#使用mysql数据库</span><br><span class="line">USE mysql; </span><br><span class="line"></span><br><span class="line">#修改'root'@'localhost'用户的密码规则和密码</span><br><span class="line">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'abc123'; </span><br><span class="line"></span><br><span class="line">#刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure><img src="https://z3.ax1x.com/2021/11/21/IXZfDx.png" alt="" style="zoom:80%;"><h2 id="6-MySQL目录结构与源码"><a href="#6-MySQL目录结构与源码" class="headerlink" title="6. MySQL目录结构与源码"></a>6. MySQL目录结构与源码</h2><h3 id="6-1-主要目录结构"><a href="#6-1-主要目录结构" class="headerlink" title="6.1 主要目录结构"></a>6.1 主要目录结构</h3><table><thead><tr><th>MySQL的目录结构</th><th>说明</th></tr></thead><tbody><tr><td>bin目录</td><td>所有MySQL的可执行文件。如：mysql.exe</td></tr><tr><td>MySQLInstanceConfig.exe</td><td>数据库的配置向导，在安装时出现的内容</td></tr><tr><td>data目录</td><td>系统数据库所在的目录</td></tr><tr><td>my.ini文件</td><td>MySQL的主要配置文件</td></tr><tr><td>c:\ProgramData\MySQL\MySQL Server 8.0\data\</td><td>用户创建的数据库所在的目录</td></tr></tbody></table><h3 id="6-2-MySQL-源代码获取"><a href="#6-2-MySQL-源代码获取" class="headerlink" title="6.2 MySQL 源代码获取"></a>6.2 MySQL 源代码获取</h3><p>首先，你要进入 MySQL下载界面。 这里你不要选择用默认的“Microsoft Windows”，而是要通过下拉栏，找到“Source Code”，在下面的操作系统版本里面， 选择 Windows（Architecture Independent），然后点击下载。 </p><p>接下来，把下载下来的压缩文件解压，我们就得到了 MySQL 的源代码。</p><p>MySQL 是用 C++ 开发而成的，我简单介绍一下源代码的组成。 </p><p>mysql-8.0.22 目录下的各个子目录，包含了 MySQL 各部分组件的源代码： </p><p><img src="https://z3.ax1x.com/2021/11/21/IXZ5VK.png"></p><ul><li><p>sql 子目录是 MySQL 核心代码；</p></li><li><p>libmysql 子目录是客户端程序 API；</p></li><li><p>mysql-test 子目录是测试工具；</p></li><li><p>mysys 子目录是操作系统相关函数和辅助函数；</p></li></ul><p>源代码可以用记事本打开查看，如果你有 C++ 的开发环境，也可以在开发环境中打开查看。 </p><p><img src="https://z3.ax1x.com/2021/11/21/IXZIUO.png"></p><p>如上图所示，源代码并不神秘，就是普通的 C++ 代码，跟你熟悉的一样，而且有很多注释，可以帮助你理解。阅读源代码就像在跟 MySQL 的开发人员对话一样，十分有趣。</p><h2 id="7-常见问题的解决-课外内容"><a href="#7-常见问题的解决-课外内容" class="headerlink" title="7. 常见问题的解决(课外内容)"></a>7. 常见问题的解决(课外内容)</h2><h3 id="问题1：root用户密码忘记，重置的操作"><a href="#问题1：root用户密码忘记，重置的操作" class="headerlink" title="问题1：root用户密码忘记，重置的操作"></a>问题1：root用户密码忘记，重置的操作</h3><p>1: 通过任务管理器或者服务管理，关掉mysqld(服务进程)<br>2: 通过命令行+特殊参数开启mysqld<br>mysqld –defaults-file=”D:\ProgramFiles\mysql\MySQLServer5.7Data\my.ini” –skip-grant-tables</p><p>3: 此时，mysqld服务进程已经打开。并且不需要权限检查<br>4: mysql -uroot 无密码登陆服务器。另启动一个客户端进行<br>5: 修改权限表<br>（1） use mysql;<br>（2）update user set authentication_string=password(‘新密码’) where user=’root’ and Host=’localhost’;<br>（3）flush privileges;<br>6: 通过任务管理器，关掉mysqld服务进程。<br>7: 再次通过服务管理，打开mysql服务。<br>8: 即可用修改后的新密码登陆。</p><h3 id="问题2：mysql命令报“不是内部或外部命令”"><a href="#问题2：mysql命令报“不是内部或外部命令”" class="headerlink" title="问题2：mysql命令报“不是内部或外部命令”"></a>问题2：mysql命令报“不是内部或外部命令”</h3><p>如果输入mysql命令报“不是内部或外部命令”，把mysql安装目录的bin目录配置到环境变量path中。如下：</p><p><img src="https://z3.ax1x.com/2021/11/21/IXZo5D.png"></p><h3 id="问题3：错误ERROR-：没有选择数据库就操作表格和数据"><a href="#问题3：错误ERROR-：没有选择数据库就操作表格和数据" class="headerlink" title="问题3：错误ERROR ：没有选择数据库就操作表格和数据"></a>问题3：错误ERROR ：没有选择数据库就操作表格和数据</h3><table><thead><tr><th>ERROR 1046 (3D000): No database selected</th></tr></thead><tbody><tr><td>解决方案一：就是使用“USE 数据库名;”语句，这样接下来的语句就默认针对这个数据库进行操作</td></tr><tr><td>解决方案二：就是所有的表对象前面都加上“数据库.”</td></tr></tbody></table><h3 id="问题4：命令行客户端的字符集问题"><a href="#问题4：命令行客户端的字符集问题" class="headerlink" title="问题4：命令行客户端的字符集问题"></a>问题4：命令行客户端的字符集问题</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO t_stu VALUES(1,'张三','男');</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: '\xD5\xC5\xC8\xFD' for column 'sname' at row 1</span><br></pre></td></tr></tbody></table></figure><p>原因：服务器端认为你的客户端的字符集是utf-8，而实际上你的客户端的字符集是GBK。</p><p><img src="https://z3.ax1x.com/2021/11/21/IXZb2d.png"></p><p>查看所有字符集：<strong>SHOW VARIABLES LIKE ‘character_set_%’;</strong></p><p><img src="https://z3.ax1x.com/2021/11/21/IXZza8.png"></p><p>解决方案，设置当前连接的客户端字符集 <strong>“SET NAMES GBK;”</strong></p><p><img src="https://z3.ax1x.com/2021/11/21/IXeCGQ.png"></p><h3 id="问题5：修改数据库和表的字符编码"><a href="#问题5：修改数据库和表的字符编码" class="headerlink" title="问题5：修改数据库和表的字符编码"></a>问题5：修改数据库和表的字符编码</h3><p>修改编码：</p><p>（1)先停止服务，（2）修改my.ini文件（3）重新启动服务</p><p>说明：</p><p>如果是在修改my.ini之前建的库和表，那么库和表的编码还是原来的Latin1，要么删了重建，要么使用alter语句修改编码。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database 0728db charset Latin1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use 0728db;</span><br><span class="line">Database changed</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table student (id int , name varchar(20)) charset Latin1;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table student\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line">Create Table: CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(20) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table student charset utf8; #修改表字符编码为UTF8</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table student\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line">Create Table: CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(20) CHARACTER SET latin1 DEFAULT NULL,  #字段仍然是latin1编码</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; alter table student modify name varchar(20) charset utf8; #修改字段字符编码为UTF8</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table student\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: student</span><br><span class="line">Create Table: CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(20) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create database 0728db;;</span><br><span class="line">+--------+-----------------------------------------------------------------+</span><br><span class="line">|Database| Create Database                                                 |</span><br><span class="line">+------+-------------------------------------------------------------------+</span><br><span class="line">|0728db| CREATE DATABASE `0728db` /*!40100 DEFAULT CHARACTER SET latin1 */ |</span><br><span class="line">+------+-------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; alter database 0728db charset utf8; #修改数据库的字符编码为utf8</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create database 0728db;</span><br><span class="line">+--------+-----------------------------------------------------------------+</span><br><span class="line">|Database| Create Database                                                 |</span><br><span class="line">+--------+-----------------------------------------------------------------+</span><br><span class="line">| 0728db | CREATE DATABASE `0728db` /*!40100 DEFAULT CHARACTER SET utf8 */ |</span><br><span class="line">+--------+-----------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> MySql </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
